1Ô∏è‚É£ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ClickResult

–§–∞–π–ª: server/services/click-handler.ts

interface ClickResult {
  clickId: string;
  redirectUrl: string;          // –í–°–ï–ì–î–ê –∑–∞–ø–æ–ª–Ω–µ–Ω (stub –µ—Å–ª–∏ –æ—à–∏–±–∫–∞)
  fraudScore: number;
  isBlocked: boolean;
  status: "valid" | "blocked" | "rejected" | "error";
  errorReason?: 
    | "offer_not_found" 
    | "offer_inactive" 
    | "no_landing" 
    | "fraud_block" 
    | "cap_reached" 
    | "geo_mismatch";
}

2Ô∏è‚É£ –£–±—Ä–∞—Ç—å –≤—Å–µ throw –∏–∑ processClick()

–ë—ã–ª–æ:

if (!offer) throw Error("Offer not found");
if (offer.status !== "active") throw Error("Offer is not active");
if (!landing) throw Error("No landing available");


–°—Ç–∞–ª–æ:

if (!offer) errorReason = "offer_not_found";
else if (offer.status !== "active") errorReason = "offer_inactive";
else if (!landing) errorReason = "no_landing";

3Ô∏è‚É£ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è processClick()

–ü–∞—Ä—Å–∏–Ω–≥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è clickId (crypto.randomUUID())

–ü—Ä–æ–≤–µ—Ä–∫–∏ ‚Üí —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ errorReason

–í–°–ï–ì–î–ê createClick()

–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ redirectUrl (stub –µ—Å–ª–∏ errorReason)

Return ClickResult

4Ô∏è‚É£ Fallback URL (stub page)
const FALLBACK_STUB_URL = "/stub"; // –∏–ª–∏ –≤–Ω–µ—à–Ω—è—è white page

const finalRedirectUrl = errorReason 
  ? (offer?.capRedirectUrl || FALLBACK_STUB_URL)
  : redirectUrl;

5Ô∏è‚É£ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ö–µ–º—ã InsertClick

–§–∞–π–ª: shared/schema.ts

status: text("status").default("valid"),  // valid | blocked | rejected | error
errorReason: text("error_reason"),        // nullable

6Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ createClick()

–§–∞–π–ª: server/storage.ts

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–µ—Ç–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–æ–≤—ã–µ –ø–æ–ª—è:

status,
errorReason

7Ô∏è‚É£ –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç—á—ë—Ç—ã / —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
–ú–µ—Ç—Ä–∏–∫–∞	–û–ø–∏—Å–∞–Ω–∏–µ
clicks_total	–í—Å–µ INSERT'—ã
clicks_valid	status = "valid"
clicks_blocked	status = "blocked"
clicks_rejected	status = "rejected"
clicks_error	status = "error"
8Ô∏è‚É£ –°–æ–∑–¥–∞—Ç—å Stub Page

–§–∞–π–ª: client/src/pages/StubPage.tsx

–ë–µ–ª—ã–π —Ñ–æ–Ω

–°–æ–æ–±—â–µ–Ω–∏–µ: "Offer unavailable"

–ë–µ–∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

9Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

–û—Ñ—Ñ–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –∫–ª–∏–∫ –∑–∞–ø–∏—Å–∞–Ω, status = error, redirect ‚Üí stub

–û—Ñ—Ñ–µ—Ä –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω ‚Üí –∫–ª–∏–∫ –∑–∞–ø–∏—Å–∞–Ω, status = rejected, redirect ‚Üí stub

–õ–µ–Ω–¥–∏–Ω–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –∫–ª–∏–∫ –∑–∞–ø–∏—Å–∞–Ω, status = error, redirect ‚Üí stub

Fraud ‚â• 80 ‚Üí –∫–ª–∏–∫ –∑–∞–ø–∏—Å–∞–Ω, status = blocked, redirect ‚Üí stub

Cap reached ‚Üí –∫–ª–∏–∫ –∑–∞–ø–∏—Å–∞–Ω, status = rejected, redirect ‚Üí cap page

üîÑ –ü–æ—Ä—è–¥–æ–∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

–°—Ö–µ–º–∞ –ë–î (shared/schema.ts)

Storage (server/storage.ts)

–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä (server/services/click-handler.ts)

Stub page (client/src/pages/StubPage.tsx)

–û—Ç—á—ë—Ç—ã / –º–µ—Ç—Ä–∏–∫–∏

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

üí° –ü–æ—Å–ª–µ —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:

Keitaro = PrimeTrack (—Ü–∏—Ñ—Ä—ã —Å—Ö–æ–¥—è—Ç—Å—è)

–ü—Ä–æ–ø–∞–≤—à–∏–µ –∫–ª–∏–∫–∏ –∏—Å—á–µ–∑–Ω—É—Ç

–î–æ–≤–µ—Ä–∏–µ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤ —Ä–∞—Å—Ç—ë—Ç

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ–ø–µ—Ä—å –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É SaaS (–∫–∞–∫ Scaleo / Voluum)