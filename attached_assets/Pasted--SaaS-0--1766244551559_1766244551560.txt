Централизованная SaaS-платформа партнёрского маркетинга
0. Общие принципы

Централизованная система: все данные и события хранятся в единой базе.

Мини-трекер: клики, лиды и продажи фиксируются внутри платформы.

Собственный click_id: генерируется платформой, ключевой для всех событий.

Опциональный postback: пользователь решает, отправлять внешним трекерам или нет.

White-label + кастомные домены: рекламодатели могут использовать свой бренд.

Переключаемый контекст рекламодателя для партнёров: партнёр видит данные только выбранного рекламодателя.

Монетизация: платные тарифы для рекламодателей, платёжные схемы за клики/действия.

Оркестр: централизованная логика управления событиями, очередями, retry и логами.

Мультиязычность: русский и английский.

Безопасность: 2FA, JWT, RBAC, audit log.

1. Роли и права
Роль	Доступ
Owner	Полный доступ, управление тарифами, оркестром, пользователями
Platform Admin	Управление пользователями, офферами, статистикой, мониторинг оркестра
Advertiser	Создание офферов, управление партнёрами, просмотр статистики, управление финансами, white-label, кастомный домен, тарифы
Affiliate	Один глобальный аккаунт → подключение к нескольким рекламодателям, переключение контекста, просмотр офферов, статистики, финансов по выбранному рекламодателю, postback (опционально)
Support	Просмотр статистики, помощь пользователям
2. Партнёрский аккаунт

Глобальный аккаунт: один логин, один пароль.

Подключение к рекламодателям через ссылки регистрации, после одобрения рекламодателем.

Переключаемый контекст:

Выбирает рекламодателя

Видит только офферы, статистику и финансы выбранного рекламодателя

Данные остальных рекламодателей полностью скрыты

3. Мини-трекер через redirect
3.1 Click flow

Пользователь кликает на партнёрскую ссылку:

https://track.domain/click?o=offer_id&a=affiliate_id&sub1=x&sub2=y


Сервер:

Генерирует click_id (UUID)

Сохраняет: click_id, offer_id, affiliate_id, advertiser_id, sub1…sub10, IP, GEO, device, OS, browser, timestamp

Проверяет:

GEO-правила

Caps (лимиты по офферу)

Статус оффера и партнёра

Антифрод

Формирует redirect URL с подставленными macros:

https://offer-landing.com/?cid={click_id}&sub1={sub1}&sub2={sub2}&aff_id={affiliate_id}

3.2 Conversion flow

Если постбек указан пользователем:

Все события (click → lead → sale) отправляются на указанный URL

Параллельно фиксируются у нас в статистике

Если постбек не указан:

Все события фиксируются в платформе

Статистика отображает click → lead → sale

Финансы рассчитываются по правилам оффера

4. Postback

Единый общий URL для всех рекламодателей и офферов партнёра

Макросы/поля:

{click_id}

{affiliate_id}

{advertiser_id}

{offer_id}

{status} (click/lead/sale/rejected)

{payout}

{currency}

{sub1…sub10}

{timestamp}

Retry и failover:

Очередь (BullMQ)

Retry 5 раз

Timeout и логирование

Статусы: success, failed, retrying

5. Офферы

Поля: id, advertiser_id, name, model (CPA/CPL/CPS/RevShare), payout, revenue, currency, geo_rules, caps, landing_urls, status, postback_secret

Партнёр видит только payout и offer name выбранного рекламодателя

Advertiser видит все поля и статистику своих офферов

6. Конверсии

Поля: conversion_id, click_id, affiliate_id, advertiser_id, offer_id, status, payout, revenue, currency, timestamp

Ведутся для всех событий (click → lead → sale)

Система рассчитывает финансы и ROI автоматически

7. Статистика

Для всех ролей: click, lead, sale, CR, EPC, revenue, payout, ROI

Фильтры: дата, рекламодатель, оффер, affiliate, GEO, device, sub1–10, click_id

В UI партнёр видит данные только выбранного рекламодателя

8. Финансы
8.1 Партнёр

Баланс по каждому рекламодателю

Hold / Approved / Paid

История выплат

8.2 Рекламодатель

Расходы по офферам

Пополнения, инвойсы

ROI, profit

9. SaaS тарифы

3–4 тарифа: Starter / Pro / Business / Enterprise

Оплата: месячная / годовая (−20% скидка за год)

Ограничения по:

количеству кликов

количеству офферов

количеству партнёров

white-label

кастомным доменам

10. White-label и кастомные домены

Advertiser может использовать:

собственный домен

собственный брендинг

ссылки регистрации партнёров

SSL автоматический

Партнёр видит только бренд рекламодателя, не платформу

11. Уведомления

Email / Telegram / Internal / Webhook

События:

Конверсия (lead/sale)

Reject

Low balance

Payout

Postback error

12. Оркестр

Централизованная очередь и обработка событий: click → lead → sale

Retry и failover

Логирование всех операций

Отдельные воркеры для:

отправки postback

расчёта финансов

генерации отчетов

13. Безопасность

JWT аутентификация

2FA

RBAC по ролям

Audit logs

IP whitelist / whitelist доменов для postback

14. Инфраструктура

Backend: NestJS

Frontend: React + Vite + Tailwind + ShadCN

DB: PostgreSQL (Drizzle ORM)

Queue: BullMQ / Redis

Dockerized

Возможность масштабирования

15. Flow diagram (текстово)
Click → сервер → генерация click_id → проверка правил → redirect на оффер
    → (lead/sale)
        ├─> Если postback указан → отправ...