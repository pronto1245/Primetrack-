SEND_API_KEY=re_EYPJoiYf_MqQj2HXNXkd7dZUCnVqGFtuT
SESSION_COOKIE_DOMAIN=.lak-dom.ru
SESSION_SECRET=f0uPiJ07Fv1X6W0znJ6kYXXEehajHs+XUbvJAfDz7/sEv/b0NHW84ozzSrXy9BZaMIGPbZcodhRDRqXfHAl7hQ==
TELEGRAM_NOTIFY_BOT_TOKEN=8114656266:AAGJMYc4seDYkuvZ-cCxL2E4sobMAbwl7AQ
TELEGRAM_SUPPORT_BOT_TOKEN=8383877045:AAFLv1xFzAVz_0z1WaW2DSjV6jYsEFy-nCw
EOF
[root@v742573 primetrack]# export $(cat .env | xargs)
pm2 start dist/index.cjs --name primetrack
pm2 save
[PM2][ERROR] Script not found: /var/www/primetrack/dist/index.cjs
[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
[root@v742573 primetrack]# cat << 'EOF' > /etc/nginx/conf.d/primetrack.conf
server {
    listen 80;
    server_name lak-dom.ru;
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto https;
    }
}
EOF

nginx -s reload
[root@v742573 primetrack]# # 1. Доустанавливаем esbuild и другие зависимости
npm install

# 2. Собираем проект через npx
npx tsx script/build.ts

# 3. Теперь файл появится, запускаем через PM2
export $(cat .env | xargs)
pm2 delete primetrack || true
pm2 start dist/index.cjs --name primetrack
pm2 save

up to date, audited 906 packages in 4s

111 packages are looking for funding
  run `npm fund` for details

29 vulnerabilities (2 low, 1 moderate, 26 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.

node:internal/modules/run_main:123
    triggerUncaughtException(
    ^
Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'esbuild' imported from /var/www/primetrack/script/build.ts
    at packageResolve (node:internal/modules/esm/resolve:873:9)
    at moduleResolve (node:internal/modules/esm/resolve:946:18)
    at defaultResolve (node:internal/modules/esm/resolve:1188:11)
    at nextResolve (node:internal/modules/esm/hooks:864:28)
    at resolveBase (file:///root/.npm/_npx/fd45a72a545557e9/node_modules/tsx/dist/esm/index.mjs?1769876058368:2:3744)
    at resolveDirectory (file:///root/.npm/_npx/fd45a72a545557e9/node_modules/tsx/dist/esm/index.mjs?1769876058368:2:4243)
    at resolveTsPaths (file:///root/.npm/_npx/fd45a72a545557e9/node_modules/tsx/dist/esm/index.mjs?1769876058368:2:4984)
    at async resolve (file:///root/.npm/_npx/fd45a72a545557e9/node_modules/tsx/dist/esm/index.mjs?1769876058368:2:5355)
    at async nextResolve (node:internal/modules/esm/hooks:864:22)
    at async Hooks.resolve (node:internal/modules/esm/hooks:306:24) {
  code: 'ERR_MODULE_NOT_FOUND'
}

Node.js v20.20.0
[PM2][ERROR] Process or Namespace primetrack not found
[PM2][ERROR] Script not found: /var/www/primetrack/dist/index.cjs
[PM2] Saving current process list...
[PM2][WARN] PM2 is not managing any process, skipping save...
[PM2][WARN] To force saving use: pm2 save --force
[root@v742573 primetrack]# 